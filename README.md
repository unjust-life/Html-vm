# mvvm
#一个简单的基于数据驱动视图的库
---
##前言
---
mvvm是一个简易的非侵入式的库。它是一个依照数据驱动视图为理念的库。在设计上上模仿了了Vue.js的很多的功能，例如data,watch,computed等。它像是一个Vue的简易版本。为什么需要这么一个库呢，它来源于对旧有项目的需求迭代。Vue.js等框架对IE8及以下并不支持，并且也不合适用于旧有项目中。所以这是一个尝试。库中默认使用了JQ提供的API，因此它是依赖于JQ的。但他也可以改造为完全不依赖任何库，使用JQ只是因为方便快捷，并且一般的旧项目至少都使用了JQ。

##介绍
mvvm提供了一个构造函数$vm。它在被实例化后会获得一个单例对象。在一个页面上应该只存在一个。对象上可以保存各种数据，并且提供了很多实用的方法。属性data对象上的根属性会被特殊化处理，以便在其改变时获得通知。同时它还能将对象上的属性绑定到视图上，并在属性改变时自动更新视图。这对于网页开发来说非常有用，同时又可以避免在全局环境下创建过多的变量。

##使用它的优势？
假如网页上需要一个按钮，需求是打开和关闭切换。最简单的方法就是创建一个变量来保存它是打开或关闭。根据判断变量的值来进行开关。
如果有多个按钮和组件状态互相关联，就为页面复杂度带来了挑战。
JQ最常做的操作就是show() hide() 根据查询一些状态来操作dom元素的隐藏与显示。
那么如果将这个过程自动化必然能带来更多的开发效率和维护难度的降低。

##快速开始
<pre><code>
快速开始，先引入js文件

new一个实例对象！

var Vm = new $vm({
	data:{},
	watch:{},
	computed:{},
	created:function(){}
})

这样就完成了！

下面会解释每个属性对象的作用。

var Vm = new $vm({
	data:{
		num: 0
	}，
	watch:{
		num(val){}
	}
})

data上定义了我们所需要的数据，比如一个输入框的数字，初始值为0。
如果改变这个值需调用set方法，才能有效的追踪修改。看一个例子。

Vm.set(prop, val)

第一个参数是要改变的属性名，第二个参数是新的值
例如Vm.set('num', 100)  就会将data下num的值改为100

先不用管这有什么用处，只要知道这是修改值的方法就好了。


watch对象可以让我们追踪那些属性什么时候发生改变，并在改变的时候执行对应函数。比如当数字等于100的时候弹出一个alert提醒
例如

watch: {
	num(val){
		console.log(num)
		if(val == 100) {
			alert('100了哦')
		}
	}
}

在num改变时 值会被打印 当值等于100时 会弹出alert  同理可以执行别的操作  例如增删dom 各种炫酷效果等等
在任何地方想获得当前对象上的数据可以直接这样Vm.data.num或者Vm.get('num')  就可以获得num现在的值了

下面介绍一下created函数
这个函数是对象初始化的时候会被执行一次，我们可以在这里进行一些特殊的操作

比如
created(){
	this.bindVal(dom, prop)
}

bindVal方法可以绑定一个值到dom节点上，并且在这个值改变的时候自动更新对应的dom节点
如果绑定的节点是输入框或者文本框下拉选项等  在视图上输入值也会同步修改对象里的属性

bindVal第一个参数为一个JQ对象，可以是任何JQ选择器所选中的dom节点，并且不限制数量，第二个参数是要绑定的属性名
例子
created(){
	this.bindVal($('.number'), 'num')
}
class=number的dom都会被赋值num的值，如果dom节点是输入框文本域或下拉框，那么在发生改变时会同步更改所有地方的num的值

computed对象用来存放计算属性的函数
常常我们会有这样的需求，对于用户输入的值进行正则验证，或者去重过滤等等。我们需要一个实时的结果，在每次原数据变动时得到一个新的结果。
例如我们想要用户输入数字的2倍的数值

首先在上一个例子中我们给$('.number') 绑定了num这个属性
如果.number是个input输入框 那么num属性会随输入实时变动

首先在created函数里新建一个计算属性并记录其依赖于num
created: function() {
	//记录计算属性的依赖 如allNum属性  依赖于num
	this.watchVal(['allNum', 'num'])
}
watchVal方法接收一个数组参数 每个项目都是字符串  第一项是要创建的计算属性的名字  例如'allNum' 后面是它所需要依赖通知的属性  如果有任何一个属性发生了改变那么它会进行计算函数返回一个新值

要让allNum产生作用需定义在computed上
在computed对象上定义一个名字叫allNum的函数 并定义其逻辑 返回2倍的num
computed: {
	allNum: function() {
		var num = Vm.data.num * 2
		$('#allNum').text(num)
		return num
	}
}
每个计算属性都需要返回一个值 会被自动写入data属性来方便获得
在使用到计算属性的时候和其他属性没有区别  可以Vm.get('allNum')  或者Vm.data.allNum来获得
注意 不要手动去改变计算属性的值 不能对它使用set方法 不然会引发错误 这是因为它任何时候都应该是个函数计算后的返回结果

</code></pre>



---
#一个简单的demo地址
https://unjust-life.github.io/mvvm/index.html

#v0.13移除绑定函数  和set函数合并  添加计算属性 computed 可根据多个值的变动而随之改变

#v0.12新增 在绑定多个dom对象后他们都会订阅对应属性 当属性改变后所有dom节点都会得到通知

#v0.11新增created之后注入data默认数据

#v0.1初始版
