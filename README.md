# mvvm

### 一个简单的基于数据驱动视图的库

### 前言

写这个作品的初衷来源于对JQ老旧项目的维护。面向过程编程，动辄数千行的JQ代码实在是难以维护和头疼。从习惯了AngularJS和Vue这种便捷工程化的前端框架再回去搞JQ的项目必然带来了一些不适应。所以我想能不能依据mvvm的思路来写一个简易的数据驱动视图的库。由此，这个作品就诞生了。

### 介绍
mvvm是一个简易的非侵入式的库。它是一个依照数据驱动视图为理念的库。参考了Vue.js的很多的功能和设计，例如data, watch, computed等。它像是一个Vue的简易版本。Vue.js等框架对IE8及以下并不支持，并且也不合适用于旧有项目中。所以这是一个尝试。库中默认使用了JQ提供的API，因此它是依赖于JQ的。但它也可以改为完全不依赖任何库，使用JQ仅仅是因为我维护的项目使用了JQ。

mvvm提供了一个构造函数$vm。它在被实例化后会获得一个对象。对象上可以保存各种数据，并且提供了很多实用的方法。data对象上的根属性会被特殊化处理，以便在其改变时获得通知。同时它还能通过提供的方法来实现数据和视图层的双向绑定。

### 特性

#### 已实现

* 兼容性 兼容IE8
* data  提供可以便捷修改获取的数据对象 不占用全局变量
* watch 提供类似于vue的侦听属性  动态追踪数据变化的方法
* computed 提供类似于vue的计算属性  动态计算复杂逻辑后的值
* bindVal 提供视图层和数据层的双向绑定

#### 待实现

* 声明式的html模板渲染 {{}}表达式
* 声明式的组件模板

### 快速开始

<pre><code>
快速开始，先引入js文件

new一个实例对象！

var Vm = new $vm({
  data:{},
  watch:{},
  computed:{},
  created:function(){}
})

这样就完成了！

下面会解释每个属性对象的作用。

var Vm = new $vm({
  data:{
    num: 0
  }，
  watch:{
    num(val){}
  }
})

data对象

data上定义了我们所需要的数据，比如一个输入框的数字，初始值为0。
如果改变这个值需调用set方法，才能有效的追踪修改。看一个例子。

Vm.set(prop, val)

第一个参数是要改变的属性名，第二个参数是新的值
例如Vm.set('num', 100)  就会将data下num的值改为100

先不用管这有什么用处，只要知道这是修改值的方法就好了。



watch对象
________________
现在我们有了个属性num，那么下一步就是定义它所需要的逻辑了

watch对象可以让我们追踪那些属性什么时候发生改变，并在改变的时候执行对应函数。
比如当数字等于100的时候弹出一个alert提醒。
例如

watch: {
  num(val){
    console.log(num)
    if(val == 100) {
      alert('100了哦')
    }
  }
}

在num改变时 值会被打印 当值等于100时 会弹出alert  同理可以执行别的操作  例如增删dom
在任何地方想获得当前对象上的数据可以直接这样Vm.data.num或者Vm.get('num')


created函数
________________
下面介绍一下created函数
这个函数是对象初始化的时候会被执行一次，我们可以在这里进行一些特殊的操作

比如
created(){
  this.bindVal(dom, prop)
}

bindVal方法可以绑定一个值到dom节点上，并且在这个值改变的时候自动更新对应的dom节点。
使用这个方法可以将简单数据和视图双向绑定，如果是复杂数据，例如数组，建议使用watch来手动渲染模板到视图上。
如果绑定的节点是输入框或者文本框下拉选项等  在视图上输入值也会同步修改对象里的属性

bindVal第一个参数为一个JQ对象，可以是任何JQ选择器所选中的dom节点，并且不限制数量，第二个参数是要绑定的属性名

例子
created(){
  this.bindVal($('.number'), 'num')
}
class=number的dom都会被赋值num的值，如果dom节点是输入框文本域或下拉框，那么在发生改变时会同步更改所有地方的num的值


计算属性
________________
computed对象用来存放计算属性的函数
常常我们会有这样的需求，对于用户输入的值进行正则验证，或者去重过滤等等。我们需要一个实时的结果，在每次原数据变动时得到一个新的结果。
例如我们想要用户输入数字的2倍的数值

首先在上一个例子中我们给$('.number') 绑定了num这个属性
如果.number是个input输入框 那么num属性会随输入实时变动

首先在created函数里新建一个计算属性并记录其依赖于num
created: function() {
  //记录计算属性的依赖 如allNum属性  依赖于num
  this.watchVal(['allNum', 'num'])
}
watchVal方法接收一个数组参数 每个项目都是字符串  第一项是要创建的计算属性的名字  例如'allNum' 后面是它所需要依赖通知的属性  如果有任何一个属性发生了改变那么它会进行计算函数返回一个新值

要让allNum产生作用需定义在computed上
在computed对象上定义一个名字叫allNum的函数 并定义其逻辑 返回2倍的num
computed: {
  allNum: function() {
    var num = Vm.data.num * 2
    $('#allNum').text(num)
    return num
  }
}

每个计算属性都需要返回一个值 会被自动写入data属性来方便获得
在使用到计算属性的时候和其它属性没有区别  可以Vm.get('allNum')  或者Vm.data.allNum来获得
注意 不要手动去改变计算属性的值 不能对它使用set方法 不然会引发错误 这是因为它任何时候都应该是个函数计算后的返回结果

</code></pre>




API文档

<pre><code>
方法

get(prop)
set(prop, data)
bindVal(data, prop)
watchVal(arr)

</code></pre>


---
#一个简单的demo地址
https://unjust-life.github.io/mvvm/index.html

#v0.13移除绑定函数  和set函数合并  添加计算属性 computed 可根据多个值的变动而随之改变

#v0.12新增 在绑定多个dom对象后它们都会订阅对应属性 当属性改变后所有dom节点都会得到通知

#v0.11新增created之后注入data默认数据

#v0.1初始版
