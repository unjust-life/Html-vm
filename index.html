<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ToDoList</title>
    <link href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="./src/vm.js"></script>
</head>
<body>
    <div class="container">
        <div class="form-group form-inline" style="margin: 20px auto;">
            <input class="form-control" type="text" data-vm="num" value="15">
            <button class="btn btn-default" type="button" id="button" data-vm="info">点击隐藏</button>
            <button class="btn btn-default" type="button" id="add">将此项目添加到列表</button>
        </div>

        <div class="alert alert-warning">
            <span>列表总和(计算属性演示)：</span>
            <span data-vm="allNum"></span>
        </div>

        <ul class="list">
            <!-- 循环列表 -->
        </ul>
    </div>
</body>

<script>



var vm = new $vm({
    // 绑定的变量值
    data: {
        info: '点击隐藏',     //控制input是否显示
        num: 100,           //绑定Input输入框的值
        list: [10]            //列表
    },
    // 数据就绪后初始化执行生命周期
    created: function() {
        //记录计算属性的依赖 如allNum属性  依赖于num
        this.watchVal(['allNum', 'list'])
    },
    // 观察者模式 某值发生变化时触发函数 进行dom操作
    watch: {
        info(val) {
            if(val === '点击隐藏') {
                $('.number').show()
            } else {
                $('.number').hide()
            }
        },
        list(val) {
            var list = ''
            // 循环数组生成dom 生成index标识
            val.forEach((e, index) => {
                var dom = `<li class="alert-success" data-index="${index}">${e}</li>`
                list += dom
            })
            $('.list').html(list)
        }
    },
    computed: {
        allNum: function() {
            var list = vm.data.list
            function count (total, num){
                return total + num
            }
            var num = list.reduce(count)
            return num
        }
    },
    // 函数
    methods: function() {
        // 点击按钮
        $('#button').click(function() {
            // 如果打开就关闭 否则打开
            if(vm.data.info === '点击隐藏') {
                vm.set('info', '点击显示')
            }else {
                vm.set('info', '点击隐藏')
            }
        })
        //添加到列表
        $('#add').click(function() {
            var num = vm.data.num

            vm.data.list.push(num)
            //触发更新
            vm.set('list', vm.data.list)
        })
    }
})
console.timeEnd('test')

</script>
</html>